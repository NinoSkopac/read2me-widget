"use strict";function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},_createClass=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),Read2MeBackend=function(){function e(t,n,i,a){if(_classCallCheck(this,e),this.apiUrl="https://api-dev.read2me.online/convert/1.0.0/webpage/",void 0===t)throw"First param to Read2MePlayer must be an App Id.";if("number"!=typeof t)throw"Public API key must be a number.";if("string"!=typeof n)throw"Second param to Read2MePlayer (url) must be a string.";if(0===n.length)throw"url must not be empty";if(void 0!==i&&null!==i&&"object"!==(void 0===i?"undefined":_typeof(i)))throw"Third param to Read2MePlayer (cssSelectors) can be omitted, null or array.";if(void 0!==a&&null!==a&&"boolean"!=typeof a)throw"Fourth param to Read2MePlayer (ignoreContentChange) can be omitted, null or a boolean.";this.appId=t,this.url=n,this.cssSelectors=i,this.ignoreContentChange=a,void 0!==this.cssSelectors&&null!==this.cssSelectors||(this.cssSelectors=[]),void 0!==this.ignoreContentChange&&null!==this.ignoreContentChange||(this.ignoreContentChange=!1)}return _createClass(e,[{key:"_getIgnoreContentChangeAsString",value:function(){return this.ignoreContentChange?"true":"false"}},{key:"getRequestUri",value:function(){return this.apiUrl+"?url="+encodeURIComponent(this.url)+"&css_selectors="+encodeURIComponent(this.cssSelectors.join("|"))+"&ignore_content_change="+this._getIgnoreContentChangeAsString()}},{key:"get",value:function(e,t,n){var i=new XMLHttpRequest;i.open("GET",this.getRequestUri(),!0),i.setRequestHeader("X-App-Id",this.appId),i.onload=function(){var a=JSON.parse(i.responseText);i.status>=200&&i.status<400?e(a):404===i.status?t(a):n(a)},i.onerror=function(){console.warn("Connection to Read2Me backend API failed.")},i.send()}},{key:"create",value:function(e,t){var n=new XMLHttpRequest;n.open("POST",this.getRequestUri(),!0),n.setRequestHeader("X-App-Id",this.appId),n.onload=function(){var i=JSON.parse(n.responseText);n.status>=200&&n.status<400?e(i):t(i)},n.onerror=function(){console.warn("Connection to Read2Me API failed.")},n.send()}}]),e}(),Read2MePlayer=function(){function e(t,n,i,a){_classCallCheck(this,e),this.eventListeners={},this.audio=new Audio,this.isPlaying=!1,this.backend=new Read2MeBackend(t,n,i,a)}return _createClass(e,[{key:"play",value:function(){this.audio.play(),this.isPlaying=!0}},{key:"pause",value:function(){this.audio.pause(),this.isPlaying=!1}},{key:"stop",value:function(){this.setCurrentTime(0),this.isPlaying=!1}},{key:"replay",value:function(){this.setCurrentTime(0),this.play()}},{key:"isPlaying",value:function(){return this.isPlaying}},{key:"setCurrentTime",value:function(e){this.audio.currentTime=e}},{key:"getCurrentTime",value:function(){return this.audio.getCurrentTime}},{key:"setPlaySpeed",value:function(e){this.audio.playbackRate=e}},{key:"getPlaySpeed",value:function(){return this.audio.playbackRate}},{key:"addEventListener",value:function(e,t){this.eventListeners[e]=t}},{key:"removeEventListener",value:function(e){delete this.eventListeners[e]}},{key:"render",value:function(){var e=this;this.backend.get(function(t){e.audio.src=t.result.audio_url},function(){e.backend.create(function(t){e.audio.src=t.result.audio_url},function(e){console.warn(e)})},function(e){console.warn(e)}),"function"==typeof this.eventListeners.ready&&this.eventListeners.ready()}}]),e}(),Read2MePlayerBuilder=function(){function e(){_classCallCheck(this,e);document.querySelectorAll(".read2me-widget").forEach(function(t){e._replaceBlueprintWithPlayer(t)})}return _createClass(e,null,[{key:"_replaceBlueprintWithPlayer",value:function(e){var t=e.getAttribute("data-url"),n=(e.getAttribute("data-autoplay"),e.getAttribute("data-sections")),i=(e.getAttribute("data-title"),e.getAttribute("data-thumbnail"),e.getAttribute("data-ignore-content-change"));new Read2MePlayer(2,t,n,i)}}]),e}();