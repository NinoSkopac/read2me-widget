"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},_createClass=function(){function o(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(e,t,n){return t&&o(e.prototype,t),n&&o(e,n),e}}();function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var config=require("../../dist/config.js"),Read2MeBackendWrapper=function(){function a(e,t){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null,o=3<arguments.length&&void 0!==arguments[3]?arguments[3]:null,r=4<arguments.length&&void 0!==arguments[4]&&arguments[4],s=5<arguments.length&&void 0!==arguments[5]?arguments[5]:"custom";_classCallCheck(this,a),this.apiUrl=a.getBaseUrl(),this.appId=e,this.url=t,this.cssSelectors=n,this.voice=o,this.ignoreContentChange=r,this.requestSource=s,this._validateRequiredParams(),this._validateOptionalParams(),this._normaliseParams()}return _createClass(a,[{key:"_validateRequiredParams",value:function(){if(void 0===this.appId)throw"First param to Read2MePlayer must be an App Id.";if("number"!=typeof this.appId)throw"Public API key must be a number.";if("string"!=typeof this.url)throw"Second param to Read2MePlayer (url) must be a string.";if(0===this.url.length)throw"url must not be empty"}},{key:"_validateOptionalParams",value:function(){if(null!==this.cssSelectors&&"object"!==_typeof(this.cssSelectors))throw"Third param to Read2MePlayer (cssSelectors) must be null or array.";if(null!==this.voice&&"string"!=typeof this.voice)throw"Fourth param to Read2MePlayer(voice) must be null or string";if("boolean"!=typeof this.ignoreContentChange)throw"Fifth param to Read2MePlayer (ignoreContentChange) must be a boolean.";if("string"!=typeof this.requestSource)throw"Sixth param to Read2MeBackend (requestSource) must be a string"}},{key:"_normaliseParams",value:function(){void 0!==this.cssSelectors&&null!==this.cssSelectors||(this.cssSelectors=[])}},{key:"_getIgnoreContentChangeAsString",value:function(){return this.ignoreContentChange?"true":"false"}},{key:"getRequestUri",value:function(){var e=null!==this.voice?encodeURIComponent(this.voice):"";return this.apiUrl+"?url="+encodeURIComponent(this.url)+"&css_selectors="+encodeURIComponent(this.cssSelectors.join("|"))+"&voice="+e+"&ignore_content_change="+this._getIgnoreContentChangeAsString()+"&request_source="+this.requestSource}},{key:"get",value:function(t,n,o){var r=new XMLHttpRequest;r.open("GET",this.getRequestUri(),!0),r.setRequestHeader("X-App-Id",this.appId),r.onload=function(){var e=JSON.parse(r.responseText);200<=r.status&&r.status<400?t(e):404===r.status?n(e):o(e)},r.onerror=function(){o(),console.warn("Connection to Read2Me backend API failed.")},r.send()}},{key:"create",value:function(t,n){var o=new XMLHttpRequest;o.open("POST",this.getRequestUri(),!0),o.setRequestHeader("X-App-Id",this.appId),o.onload=function(){var e=JSON.parse(o.responseText);200<=o.status&&o.status<400?t(e):n(e)},o.onerror=function(){n(),console.warn("Connection to Read2Me API failed.")},o.send()}},{key:"deleteCache",value:function(t,n){var e=this.apiUrl+"cache/?url="+encodeURIComponent(this.url),o=new XMLHttpRequest;o.open("DELETE",e,!0),o.setRequestHeader("X-App-Id",this.appId),o.onload=function(){var e=JSON.parse(o.responseText);200<=o.status&&o.status<400?t(e):n(e)},o.onerror=function(){n(),console.warn("Connection to Read2Me API failed.")},o.send()}},{key:"refreshCreate",value:function(t,n){var o=this;this.deleteCache(function(e){o.create(function(e){t(e)},function(e){n(e)})},function(e){n(e)})}}],[{key:"getBaseUrl",value:function(){return config.apiEndpoint+"convert/1.0.0/webpage/"}}]),a}();exports.default=Read2MeBackendWrapper;